# Практическая работа: Ассемблер для Учебной Виртуальной Машины (УВМ)

**Вариант №23**  
**Студент:** Цветкова Е.А.  
**Группа:** ИКБО-17-22

---

## 1. Общее описание

Проект представляет собой ассемблер и интерпретатор для учебной виртуальной машины (УВМ). Реализация выполнена на языке Python 3. Проект разрабатывается в несколько этапов, текущий этап — реализация ассемблера, преобразующего текстовое представление программы в промежуточное представление и бинарный формат, соответствующий спецификации УВМ.

### Архитектура УВМ:
- **Стековая архитектура**
- **4 типа команд:** CONST, LOAD, STORE, BITREV
- **Размер команды:** 4 байта
- **Формат команды:** 6 бит для кода операции (A), 26 бит для аргумента (B)

### Команды УВМ:
1. **CONST (A=42)** - загрузка константы на стек
2. **LOAD (A=23)** - чтение значения из памяти по адресу
3. **STORE (A=1)** - запись значения в память
4. **BITREV (A=60)** - унарная операция обращения битов

## 2. Описание всех функций и настроек

### Основные модули:

#### `assembler.py` - основной модуль ассемблера

**Класс `Assembler`**:
- `__init__()` - инициализация ассемблера
- `parse_line(line: str)` - разбор одной строки ассемблерного кода
- `parse_number(s: str)` - преобразование строки в число (поддерживает десятичный, шестнадцатеричный, двоичный, восьмеричный форматы)
- `assemble(source: str)` - двухпроходное ассемблирование исходного текста
- `encode_instruction(cmd: dict)` - кодирование команды в бинарный формат
- `to_binary(program: list)` - преобразование всей программы в бинарный формат
- `format_intermediate(program: list)` - форматирование промежуточного представления для отладки

**Перечисление `Opcode`**:
- `STORE = 1`
- `LOAD = 23` 
- `CONST = 42`
- `BITREV = 60`

**Словарь мнемоник `MNEMONICS`**:
- `'store'` → `Opcode.STORE`
- `'load'` → `Opcode.LOAD`
- `'const'` → `Opcode.CONST`
- `'bitrev'` → `Opcode.BITREV`

**Функция `main()`**:
- Обработка аргументов командной строки
- Чтение исходного файла
- Вызов ассемблирования
- Запись результата в бинарный файл

### Промежуточное представление:
Каждая команда представляется в виде словаря:
```python
{
    'address': 0,           # Адрес команды в памяти
    'opcode': 42,           # Числовой код операции
    'mnemonic': 'const',    # Текстовая мнемоника
    'args': ['125'],        # Аргументы из исходного текста
    'value': 125,           # Распарсенное значение (для CONST)
    'address_arg': 558,     # Распарсенный адрес (для LOAD)
    'raw_line': 'const 125' # Исходная строка
}
```
### Настройки:
- Кодировка файлов: UTF-8
- Порядок байт: little-endian (`<` в struct.pack)
- Размер слова: 4 байта
- Поддерживаемые системы счисления: десятичная, шестнадцатеричная (0x), двоичная (0b), восьмеричная (0o)

### 3. Описание команд для сборки проекта и запуска тестов

### Требования к окружению:
- Python 3.6 или выше
- Стандартные библиотеки Python (struct, enum, typing, sys)
### Установка:
```bash
# Клонирование репозитория (пример)
git clone https://github.com/username/uvm-assembler.git
cd uvm-assembler

# Проверка версии Python
python3 --version
```

### Основные команды:
**Компиляция программы**:
```bash
# Базовый синтаксис
python3 assembler.py <входной_файл.asm> <выходной_файл.bin>

# Пример
python3 assembler.py program.asm program.bin
```
**Компиляция с отладкой (режим тестирования)**:
```bash
python3 assembler.py program.asm program.bin --test
```
